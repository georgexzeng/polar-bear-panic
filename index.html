<!doctype html>
<html lang="en">
<head>
	<meta charset="UTF-8" />
    <title>Polar Bear Panic</title>
	<script type="text/javascript" src="js/phaser.min.js"></script>
    <style type="text/css">
        canvas {
            margin: auto;
            border-radius: 5px;
            position: absolute;
            top: 0;
            left: 0;
            bottom: 0;
            right: 0;
        }
    </style>
</head>
<body>

<script type="text/javascript">

var game = new Phaser.Game(800, 600, Phaser.AUTO, 'phaser-example', { preload: preload, create: create, update: update });

var Bear = function(game, x, y, frame) {

    Phaser.Sprite.call(this, game, x, y, 'bear', frame);

    this.game.physics.arcade.enableBody(this);

    this.body.collideWorldBounds = true;
    this.body.gravity.y = 600;
    this.body.maxVelocity = 1000;

    this.animations.add('left', [0, 1], 10, true);
    this.animations.add('right', [0, 1], 10, true);
    this.anchor.setTo(.5);
    this.body.drag.x = 800;

};

Bear.prototype = Object.create(Phaser.Sprite.prototype);
Bear.prototype.constructor = Bear;

  // RIGHT MOVEMENT
Bear.prototype.runRight = function(){
  this.body.drag.x = 200;
  this.body.velocity.x = 400;
  this.scale.x = 1;
  this.animations.play('right');
};
  // LEFT MOVEMENT
Bear.prototype.runLeft = function(){
  this.body.drag.x = 200;
  this.body.velocity.x = -400;
  this.scale.x = -1;
  this.animations.play('left');
};
  //JUMPING
Bear.prototype.jump = function(){
    this.body.velocity.y = -600;
};

Bear.prototype.stop = function(){
    this.body.drag.x = 200;
    this.animations.stop();
    this.frame = 2;
}


module.exports = Bear;

function preload() {

    this.game.load.image('sky', 'assets/sky2.png');
    this.game.load.image('kenney', 'assets/kenney.png');
    this.game.load.tilemap('map', 'assets/block_platform_snow.json', null, Phaser.Tilemap.TILED_JSON);
    this.game.load.spritesheet('snow', 'assets/snow.png', 17, 17);
    this.game.load.spritesheet('bear', 'assets/bear.png', 90, 50, 3);
    this.game.load.spritesheet('fish', 'assets/fish.png', 25, 45);
    this.game.load.spritesheet('iceberg', 'assets/iceberg.png', 110, 76);

}

var Bear;
var cursors;
var sky;
var map;
var layer;
var snow;
var bear;
var hardRain;
var iceberg;

function create() {

    this.game.physics.startSystem(Phaser.Physics.ARCADE);
    this.game.physics.arcade.gravity.y = 300;
    // this.bear = this.add.sprite(200, 5, 'bear');

    cursors = this.game.input.keyboard.createCursorKeys();

    sky = this.game.add.image(0, 0, 'sky');
    sky.fixedToCamera = true;


    map = this.game.add.tilemap('map');
    map.addTilesetImage('kenney');
    layer = map.createLayer('Tile Layer 1');
    this.game.physics.enable(layer, Phaser.Physics.ARCADE);
    map.setCollisionBetween(1, 100000, true, 'Tile Layer 1');
    layer.resizeWorld();

    snow = this.game.add.emitter(this.game.world.centerX, 0, 1000);
    snow.width = this.game.world.width;
    snow.makeParticles('snow');
    snow.minParticleScale = 0.4;
    snow.maxParticleScale = 0.8;
    snow.setYSpeed(300, 500);
    snow.setXSpeed(-500, -1000);
    snow.minRotation = 0;
    snow.maxRotation = 0;
    snow.start(false, 1600, 5, 0);

    this.bear = new Bear(this.game, 100, 400);
    console.log(this.bear);
    this.game.physics.enable(this.bear, Phaser.Physics.ARCADE);
    this.game.add.existing(this.bear);
    this.game.camera.follow(this.bear);


    hardRain = this.game.add.emitter(this.game.world.centerX, 0, 100);
    this.game.physics.enable(hardRain, Phaser.Physics.ARCADE)
    hardRain.width = this.game.world.width;
    hardRain.makeParticles('fish');
    hardRain.setYSpeed(300, 500);
    hardRain.setXSpeed(-500, -1000);
    hardRain.minRotation = 360;
    hardRain.maxRotation = 90;
    hardRain.start(false, 1600, 5, 0);

}

function update() {

    this.game.physics.arcade.collide(this.bear, layer);
    this.game.physics.arcade.collide(this.bear, hardRain);

    if (cursors.left.isDown) {
        this.bear.runLeft();

    } else if (cursors.right.isDown) {
        this.bear.runRight();

    } else {
        this.bear.stop();
    }

    if (cursors.up.isDown && this.bear.body.onFloor()) {
        this.bear.jump();
    }
}

</script>
</body>
</html>
